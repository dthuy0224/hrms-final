<!DOCTYPE html>
<html>
    <%- include('../partials/header') %>

    <body>
        <nav class="navbar navbar-default no-margin">
            <!-- Brand and toggle get grouped for better mobile display -->

            <div class="navbar-header fixed-brand">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" id="menu-toggle">
                    <span class="glyphicon glyphicon-th-large" style="margin-left:5px;" aria-hidden="true"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <%= userName %>
                </a>
            </div><!-- navbar-header-->

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <button class="navbar-toggle collapse in" data-toggle="collapse" id="menu-toggle-2"><span
                                class="glyphicon glyphicon-th-large" aria-hidden="true"></span></button>
                    </li>
                    <li class="navbar-brand">
                        <form action="/logout" method="get">
                            <button id="logout" type="submit" style="margin-top: -3px;" class="btn btn-default"><i
                                    class="fa fa-user" aria-hidden="true"></i> Logout
                            </button>
                        </form>
                    </li>
                </ul>
            </div><!-- bs-example-navbar-collapse-1 -->
        </nav>
        <div id="wrapper">
            <!-- Include the sidebar partial with path parameter -->
            <% 
            // Define path if not defined
            var currentPath = typeof path !== 'undefined' ? path : '/manager/view-attendance';
            %>
            <%- include('../partials/sidebar', {path: currentPath}) %>
            <!-- Page Content -->
            <div id="page-content-wrapper">
                <div class="container-fluid xyz">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="page-header">
                                <ol class="breadcrumb">
                                    <li><a href="/manager">Dashboard</a></li>
                                    <li class="active">Attendance Sheet</li>
                                </ol>
                                <h3><i class="fa fa-calendar"></i> Attendance for <%= moment().month(Number(month)-1).format('MMMM') %></h3>
                            </div>

                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h4><i class="fa fa-calendar-check-o"></i> Attendance Records</h4>
                                        </div>
                                        <div class="col-md-6 text-right">
                                            <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">
                                                <i class="fa fa-filter"></i> Change Month/Year
                                            </button>
                                            <button class="btn btn-success btn-sm" data-toggle="modal" data-target="#myModal2">
                                                <i class="fa fa-check-circle"></i> Mark Attendance
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <% if (found===1){ %>
                                        <div class="table-responsive">
                                            <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                                <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Status</th>
                                                        <th>Check-in Time</th>
                                                        <th>Check-out Time</th>
                                                    </tr>
                                                </thead>
                                                <tfoot>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Status</th>
                                                        <th>Check-in Time</th>
                                                        <th>Check-out Time</th>
                                                    </tr>
                                                </tfoot>
                                                <tbody>
                                                    <% attendance.forEach(function(item){ %>
                                                        <tr>
                                                            <td>
                                                                <%= moment(item.month + "/" + item.date + "/" + item.year).format('MMMM Do YYYY'); %>
                                                            </td>
                                                            <td><span class="label label-success">Present</span></td>
                                                            <td>
                                                                <%= item.checkInTime || '09:00:00' %>
                                                            </td>
                                                            <td>
                                                                <%= item.checkOutTime || 'Not checked out' %>
                                                            </td>
                                                        </tr>
                                                    <% }); %>
                                                </tbody>
                                            </table>
                                        </div>
                                    <% } else { %>
                                        <div class="alert alert-info">
                                            <i class="fa fa-info-circle"></i> No attendance records found for the selected month and year.
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /#page-content-wrapper -->
        </div>
        <!-- /#wrapper -->
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.js" charset="UTF-8"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.js" charset="UTF-8"></script>
        <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
        <script src="/javascripts/sidebar_menu.js"></script>
        <script>
            $(document).ready(function () {
                $('#example').dataTable({
                    /* No ordering applied by DataTables during initialisation */
                    "order": []
                });
                // Setup - add a text input to each footer cell
                $('#example tfoot th').each(function () {
                    var title = $(this).text();
                    if (title != " ") {
                        $(this).html('<input type="text" class="form-control" placeholder="Search ' + title + '" />');
                    }
                });

                // DataTable
                var table = $('#example').DataTable();

                // Apply the search
                table.columns().every(function () {
                    var that = this;

                    $('input', this.footer()).on('keyup change', function () {
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                });
                for (i = new Date().getFullYear(); i > 1900; i--) {
                    $('#year').append($('<option />').val(i).html(i));
                }
            });
        </script>
    </body>

    <%- include('../partials/modals') %>

</html>